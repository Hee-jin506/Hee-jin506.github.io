---
layout: post
title: "[김효곤 교수의 인터넷 프로토콜] 2. 데이터링크 계층과 인터페이스"
categories:
  - Internet Protocol
tags:
  - 인터넷, 프로토콜, 그리고 계층화 원칙
---

# 데이터링크 계층과 인터페이스

### 2.1 데이터링크의 기능

- 인터"넷" = 데이터링크
- 데이터 통신 과목에서 배운 데이터링크의 4기능(프레이밍, 흐름제어, 에러제어, 회선 제어)을 IP가 알아야 할 필요는 없다.
- 그럼 IP는 인터넷에 쓰이고자 하는 데이터링크 기술에 대해 무엇을 알아야 하는가?

우리는 데이터링크 계층을 다루면서 데이터링크 계층 자체의 기능보다는 IP에서 데이터링크의 의미를 이해하기 위해 IP가 인터페이스라고 부르는 부분을 중점으로 알아볼 것이다.

### 2.2 IP가 데이터링크 계층에 요구하는 것

- 캡슐화(Encapsulation)
  데이터링크 계층에서 IP 데이터그램을 페이로드에 싣고서 자신의 짐칸에 IP 데이터그램이 실려있다는 표시를 해야 한다. 이것이 IP 기술이 데이터링크 기술에게 요구하는 첫번째 조건이며, 부가적으로는 몇 바이트까지 실을 수 있느냐에 대한 MTU(Maximum Transmission Unit) 정보도 제공해야 한다.
- ARP(Address Resolution Protocol)
  시베리아 횡단 열차의 예시에서, 바퀴 없는 객실만으로는 이동이 불가능한 것처럼, IP 주소만을 갖고는 데이터가 배달될 수 없다. IP 주소는 발이 없다. 늘상 한 링크를 건널 때마다 데이터링크 기술에 의존해야 한다. 예를 들어, wifi나 이더넷과 같은 shared medium 종류의 데이터링크 기술에서는 MAC 주소(한 홉을 가는데 필요한 주소로 하드웨어 하나당 하나씩 할당된다.)를 사용해야 하는 데이터링크 기술들은 특히나 해당 IP 주소만으로는 불가능하다. 따라서 IP는 데이터링크 기술이 스스로 데이터를 전송해하는 기능을 갖추기를 요구한다.

- MIB(Management Information Base) - 나중에 더 구체적으로 설명하게 될 것이다.
  관리자(Manager)와 대리인(Agent) 사이에 특정한 정보를 주고 받는 것이 네트웍 관리의 기본이다. 관리되어야 할 특정한 정보, 자원을 객체라 하는데, 이런 객체들을 모아놓은 집합체를 MIB(Management Information Base)라고 한다.

### 2.2 IP가 데이터링크 계층에 요구하는 것(1) - 캡슐화

- 캡슐화(encapsulation)
  - 예시) IP데이터그램이 있음을 표시하기 위해 이더넷 프레임에는 0x0800이라는 숫자를 적는다.
    - 그 밖에 프레임 타입에 어떤 숫자가 들어가느냐에 따라서 다음에 따라오는 데이터의 내용이 달라진다. 


![]({{site.url}}/assets/images/91.png)

![]({{site.url}}/assets/images/92.png)

![]({{site.url}}/assets/images/93.png)

- 위의 그림은 각각의 데이터링크 기술의 헤더에서 IP데이터그램이 실려있음을 표시하는 부분을 나타낸다.
  - 첫번째 유선 LAN
  - 두번째 PPP
  - 세번째 무선 LAN
  - 네번째 이더넷

### 2.2 IP가 데이터링크 계층에 요구하는 것(2) - ARP

- IP는 각 라우터에서 목적지 IP주소를 가기 위해 다음에 거쳐야할 라우터("홉")을 알아낼 수 있다.
  특정 하드웨어에서 데이터가 출발하여 여러 라우터를 거친 후 최종 목적지에 도달하려면 가장 먼저, 출발지에서 넘어갈 최초의 라우터(다음 홉)을 알아야 한다. 
  - Windows에서 route -4 print 명령어를 입력하면 다음 그림과 같은 테이블이 나타난다. 

![]({{site.url}}/assets/images/94.png)

위의 테이블은 라우팅 테이블로, 해당 PC의 패킷이 특정 목적지를 가기 위해서 어디로 나가야할지를 정해준다. 그런데 네트워크 대상이 목적지의 IP 주소이고, 실제로 가야하는 목적지와 네트워크 마스크를 AND시킨 결과가 네트워크 대상과 일치할 경우, 해당 경로로 패킷이 나가면 된다. 

라우팅 테이블에서 주어진 경로는 목적지에 도달하기 위해 거쳐야할 바로 다음 홉까지만이다. 바로 다음 홉은 게이트웨이에서 IP주소를 확인할 수 있고, 그 게이트웨이를 찾아가기 위해서 진입해야되는 인터페이스들이 다음 컬럼으로 나타난다. 따라서 해당 목적지로 가려면 호스트에 설치된 인터페이스들 중 정해진 인터페이스로 나와 게이트웨이 IP 주소로 가면 되는 것이다.

> 인터페이스
>
> 네트워크에 연결될 수 있는 기기는 한 개 이상의 인터페이스가 설치되어있다. 예를 들어, 어떤 안드로이드 폰에는 wifi 인터페이스와 5G 인터페이스, LTE 인터페이스 등이 있다. 이 각각의 인터페이스는 서로 다른 IP 주소를 한 개씩 할당받는다. 따라서 IP 주소는 컴퓨터 에 붙는 것이 아니라, 인터페이스가 붙는 것이다.

그런데 문제는 이 라우팅 테이블에 쓰여진 게이트웨이, 즉 IP 주소만 알아서는 패킷이 보내질 수 없다.

- IP 주소는 발이 없다. 
  - 패킷을 물리적으로 전달해주는 "발"의 역할을 링크 기술이 해주어야 한다. 
  - 대표적으로는 MAC 주소를 이용해서 전송이 된다.

- 각 링크마다 "발을 갈아 끼우고" 전진
  - 여러 개의 서로 다른 링크를 거쳐지나가야할 경우, 다른 링크로 넘어갈 때마다 라우터에서 프레임워크를 갈아끼우면서 다른 링크에서도 이어 패킷이 전송될 수 있도록 해야한다.
  - 어떤 기술들은 나름의 배달 방식이 있다.
    - 공유형 링크와 점대점 링크

- 링크 계층 기술의 2타입
  - 공유형 링크(shared medium) - wifi/ethernet
    - 하나의 공유된 전송 회선에 여러 노드가 접속되어있는 형태의 링크를 말한다.
      - 인터페이스라는 문을 열고 나오면 호텔 복도처럼 하나의 길 위에 여러 곳으로 통하는 문들이 있다.
    - MAC 주소가 필요
  - 점대점 링크(point-to-point link) - ADSL
    - 두 노드가 1:1로 직접 연결되어있는 형태의 링크 기술이다.
      - 인터페이스라는 문을 열고 나오면 다른 한 곳으로 가는 길 하나만 있을 뿐이다.
    - ADSL : 전화선을 사용
    - ARP가 전혀 필요 없다. 따라서 MAC 주소도 필요 없다.
- 주소 결정 프로토콜 (ARP)
  - 결정(resolution): 공유형 링크는 한 회선을 여러 개의 노드가 공유하고 있기 때문에, 인터페이스를 통해 패킷이 나가더라도 원하는 라우터를 선택해서 전송되어야 한다.
  - 원하는 라우터의 IP 주소를 알고 있다고 해서, 다음 홉을 갈 수 있는 것이 아니다. 공유형 링크에서는 MAC 주소를 알아야만 원하는 라우터로 패킷을 보낼 수가 있다.
  - 원하는 라우터의 IP 주소를 안다는 가정 하에, 이 라우터의 MAC 주소를 알아내어 그 곳으로 패킷을 보내주는 기술

